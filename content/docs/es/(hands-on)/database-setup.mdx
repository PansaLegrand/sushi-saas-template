---
title: Configuraci√≥n de la base de datos
icon: "Database"
description: C√≥mo preparar Postgres y Drizzle ORM para Better Auth y las tablas de la app.
keywords:
  - Postgres
  - Drizzle ORM
  - migraciones
  - Better Auth
  - esquema
  - Next.js
  - base de datos
tags: [base de datos, Drizzle, Postgres]
author: "Pansa Legrand"
publishedAt: "2025-09-29T00:00:00.000Z"
updatedAt: "2025-09-29T00:00:00.000Z"
canonical: "https://www.sushi-templates.com/es/blogs/database-setup"
---

Antes de que funcionen las pantallas de autenticaci√≥n necesitas una base de
datos lista. Esta gu√≠a explica las herramientas incluidas (Drizzle ORM), los
escenarios habituales, los archivos que debes editar y los comandos que tienes
que ejecutar despu√©s.

## 1. ¬øQu√© es Drizzle ORM?

Usamos **[Drizzle ORM](https://orm.drizzle.team/)** como capa tipada entre
TypeScript y Postgres. El esquema en `src/db/schema.ts` es la √∫nica fuente de
verdad. Desde ese archivo podemos:

- Generar migraciones SQL con `drizzle-kit`
- Ejecutar migraciones contra Postgres
- Compartir tipos en toda la app (por ejemplo `users.$inferSelect`)

No edites SQL a mano; modifica el esquema y deja que Drizzle cree y aplique las
migraciones.

## 2. Elige tu escenario de base de datos

No existe una configuraci√≥n √∫nica. Escoge el escenario que mejor encaje y
actualiza `.env`.

| Escenario | Recomendaci√≥n |
| --- | --- |
| **Solo desarrollo local** | Ejecuta Postgres con Docker (por ejemplo `docker run ... postgres:16`) y apunta `DATABASE_URL` a `postgres://postgres:postgres@localhost:5432/postgres`. |
| **Postgres gestionado (Neon, Supabase, Railway, Render...)** | Copia la cadena de conexi√≥n del proveedor y aseg√∫rate de permitir la IP desde la que ejecutas migraciones. |
| **BD diferente por entorno** | Usa `.env` para desarrollo local y configura los secretos de producci√≥n directamente en tu hosting. |
| **Base de datos existente con otras tablas** | Drizzle solo modificar√° las tablas declaradas en `src/db/schema.ts`. Comprueba que no haya conflictos de nombres o crea un schema distinto. |

> Consejo: Drizzle no crea la base de datos. Crea la BD vac√≠a antes de lanzar
> las migraciones.

## 3. Configura las variables de entorno

Define la cadena de conexi√≥n y los secretos de Better Auth. Leemos `.env`,
`.env.local` y `.env.development` por defecto.

```bash  title=".env"
DATABASE_URL="postgresql://user:password@host:5432/db?sslmode=require"
BETTER_AUTH_SECRET="$(openssl rand -base64 32)"
BETTER_AUTH_URL="http://localhost:3000"
```

Reinicia `pnpm dev` despu√©s de cambiar cualquier valor para que el proceso los
recargue.

## 4. Conoce los archivos del esquema

- `src/db/schema.ts` ‚Äì modelos Drizzle para **Better Auth** (`users`, `sessions`,
  `accounts`, `verifications`) y tablas propias (`orders`, `credits`, etc.).
- `src/db/config.ts` ‚Äì configuraci√≥n de drizzle-kit que apunta al esquema y a la
  URL de Postgres.
- `src/lib/auth.ts` ‚Äì mapea los campos de Better Auth hacia las columnas Drizzle.
  Actualiza este archivo si renombras columnas en `users`.

Cuando necesites nuevas columnas o tablas, modifica `schema.ts` y, si aplica, el
mapeo correspondiente en `auth.ts`.

## 5. Genera migraciones tras cambiar c√≥digo

Cada vez que cambie `schema.ts`, ejecuta:

```bash
pnpm drizzle-kit generate --config src/db/config.ts
```

Salida esperada (ejemplo):

```
Reading config file 'src/db/config.ts'
...
[‚úì] Your SQL migration file ‚ûú src/db/migrations/0002_add_user_flag.sql üöÄ
```

El comando crea dos archivos:

- `src/db/migrations/<timestamp>_*.sql` ‚Äì el SQL que se ejecutar√°
- `src/db/migrations/meta/_journal.json` ‚Äì el registro de migraciones

Acu√©rdate de a√±adir ambos archivos al control de versiones.

## 6. Aplica las migraciones a Postgres

Ejecuta el SQL generado sobre la base de datos:

```bash
pnpm drizzle-kit migrate --config src/db/config.ts
```

Ejemplo de √©xito:

```
Applying migrations from src/db/migrations
Migration 0002_add_user_flag.sql executed in 380 ms
All migrations applied!
```

Si ves errores de autenticaci√≥n, revisa `DATABASE_URL`. Si el comando se queda
colgado o caduca, verifica permisos de red o que el contenedor est√© encendido.

## 7. Valida el resultado

Usa cualquier cliente Postgres para inspeccionar las tablas/columnas. Con `psql`:

```sql
\dt
SELECT * FROM sessions LIMIT 1;
SELECT email_verified FROM users LIMIT 1;
```

Deber√≠as ver las tablas de Better Auth y las columnas nuevas que a√±adiste.

## 8. Prueba el flujo de autenticaci√≥n

Despu√©s de aplicar las migraciones, reinicia `pnpm dev`, abre `/es/signup` (o la
ruta con tu locale) y crea un usuario. Deber√≠as volver a la home y ver registros
nuevos en `users` y `sessions`.

## 9. Soluci√≥n de problemas

- **Error: model "userss" not found** ‚Äì Comprueba que `src/lib/auth.ts`
  referencia la tabla correcta (`users`). Elimina `usePlural` si lo copiaste de
  ejemplos antiguos.
- **Falta una columna al iniciar sesi√≥n** ‚Äì Cambiaste `schema.ts` pero olvidaste
  ejecutar `generate` + `migrate`. Vuelve a generarlas.
- **No se puede conectar a la base de datos** ‚Äì Confirma que la BD existe, las
  credenciales son correctas y que la red permite conexiones.
- **Necesito borrar todo** ‚Äì Elimina las tablas manualmente o usa el SQL de
  drizzle-kit para revertirlas antes de volver a ejecutar `generate` y
  `migrate`.

Sigue siempre esta secuencia: modifica el c√≥digo, genera migraciones, apl√≠calas y
valida. As√≠ evitar√°s errores 500 en los flujos de autenticaci√≥n.
